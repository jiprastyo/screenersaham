<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Screener Saham Indonesia</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=Instrument+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  /* Dark theme (default) */
  --bg:        #07080d;
  --bg2:       #0c0f18;
  --surface:   #111520;
  --surface2:  #161b28;
  --surface3:  #1c2133;
  --border:#252d42;
  --border2:#303a54;
  --text:      #edf0f7;
  --text2:#b0bcd4;
  --text3:#6b7a96;
  --text4:     #303a54;

  --gold:      #f5a623;
  --gold-bg:   rgba(245,166,35,.1);
  --gold-dim:  rgba(245,166,35,.18);
  --gold-h:    #e8940d;

  --green:     #22c55e;
  --green-bg:  rgba(34,197,94,.08);
  --green-dim: rgba(34,197,94,.18);

  --red:       #f25e5e;
  --red-bg:    rgba(242,94,94,.08);
  --red-dim:   rgba(242,94,94,.18);

  --blue:      #60a5fa;
  --blue-bg:   rgba(96,165,250,.08);
  --blue-dim:  rgba(96,165,250,.18);

  --teal:      #2dd4bf;
  --teal-bg:   rgba(45,212,191,.08);
  --teal-dim:  rgba(45,212,191,.18);

  --amber:     #f59e0b;
  --amber-bg:  rgba(245,158,11,.09);
  --amber-dim: rgba(245,158,11,.2);

  --purple:    #a78bfa;
  --purple-bg: rgba(167,139,250,.08);
  --purple-dim:rgba(167,139,250,.18);

  --font: 'Instrument Sans', system-ui, sans-serif;
  --mono:'Instrument Sans', 'Courier New', monospace;
  --r: 10px; --rs: 6px; --rx: 20px;

  --shadow-sm: 0 1px 3px rgba(0,0,0,.4);
  --shadow:    0 2px 8px rgba(0,0,0,.5);
  --shadow-lg: 0 8px 24px rgba(0,0,0,.6);

  /* Score colors */
  --score-hi:   #22c55e;
  --score-hi-bg:rgba(34,197,94,.12);
  --score-md:   #2dd4bf;
  --score-md-bg:rgba(45,212,191,.1);
  --score-lo:   #f59e0b;
  --score-lo-bg:rgba(245,158,11,.1);
  --score-vlo:  #4b5563;
  --score-vlo-bg:rgba(75,85,99,.15);
}
[data-theme="light"]{
  --bg:#f1f3f8; --bg2:#e8ebf2; --surface:#fff; --surface2:#f5f7fb; --surface3:#edf0f6;
  --border:#d0d5e2; --border2:#b8bfd2;
  --text:#0f1423; --text2:#3d4860; --text3:#7a869e; --text4:#d5dae8;
  --gold:#d4861a; --gold-bg:rgba(212,134,26,.08); --gold-dim:rgba(212,134,26,.15); --gold-h:#b8720d;
  --green:#16a34a; --green-bg:rgba(22,163,74,.06); --green-dim:rgba(22,163,74,.15);
  --red:#dc2626; --red-bg:rgba(220,38,38,.06); --red-dim:rgba(220,38,38,.15);
  --blue:#2563eb; --blue-bg:rgba(37,99,235,.07); --blue-dim:rgba(37,99,235,.15);
  --teal:#0d9488; --teal-bg:rgba(13,148,136,.07); --teal-dim:rgba(13,148,136,.15);
  --amber:#b45309; --amber-bg:rgba(180,83,9,.07); --amber-dim:rgba(180,83,9,.18);
  --purple:#6d28d9; --purple-bg:rgba(109,40,217,.07); --purple-dim:rgba(109,40,217,.15);
  --shadow-sm:0 1px 2px rgba(0,0,0,.06); --shadow:0 2px 8px rgba(0,0,0,.08); --shadow-lg:0 8px 24px rgba(0,0,0,.1);
  --score-hi:#16a34a; --score-hi-bg:rgba(22,163,74,.1);
  --score-md:#0d9488; --score-md-bg:rgba(13,148,136,.08);
  --score-lo:#b45309; --score-lo-bg:rgba(180,83,9,.08);
  --score-vlo:#9ca3af; --score-vlo-bg:rgba(156,163,175,.12);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{font-size:18px;-webkit-text-size-adjust:100%}
body{font-family:var(--font);background:var(--bg);color:var(--text);min-height:100vh;line-height:1.5;transition:background .2s,color .2s}
a{color:inherit;text-decoration:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOPBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.topbar{
  background:var(--surface);
  border-bottom:1px solid var(--border);
  padding:0 1.1rem;display:flex;align-items:center;
  height:56px;gap:.5rem;position:sticky;top:0;z-index:300;
  box-shadow:var(--shadow);
}
.brand{display:flex;align-items:center;gap:.3rem;flex-shrink:0}
.brand-text{font-weight:700;font-size:.95rem;letter-spacing:-.02em;line-height:1}
.brand-sub{font-size:.62rem;color:var(--text3);font-weight:400;margin-top:1px}

.topbar-meta{
  display:flex;align-items:center;gap:.8rem;font-size:.7rem;
  color:var(--text3);flex:1;min-width:0;overflow:hidden;padding-left:.4rem;
}
.meta-pill{
  display:flex;align-items:center;gap:.25rem;white-space:nowrap;
  background:var(--surface2);border:1px solid var(--border);
  padding:.18rem .5rem;border-radius:20px;font-size:.65rem;
}
.dot{width:5px;height:5px;border-radius:50%;background:var(--text4);flex-shrink:0;transition:background .3s}
.dot.ok{background:var(--green)}.dot.spin{background:var(--gold);animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

.topbar-r{display:flex;align-items:center;gap:.35rem;margin-left:auto;flex-shrink:0}
.tbtn{
  display:inline-flex;align-items:center;gap:.22rem;
  padding:.3rem .6rem;border-radius:var(--rs);border:1px solid var(--border);
  background:transparent;color:var(--text2);font-family:var(--font);
  font-size:.7rem;cursor:pointer;font-weight:500;white-space:nowrap;
  line-height:1;transition:all .12s;
}
.tbtn:hover{background:var(--surface2);color:var(--text);border-color:var(--border2)}
.tbtn.active{background:var(--gold-bg);border-color:var(--gold);color:var(--gold)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pbar{height:2px;background:var(--border);position:sticky;top:56px;z-index:299}
.pbar-fill{height:100%;background:linear-gradient(90deg,var(--gold),var(--green));width:0;transition:width .25s}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page{max-width:1680px;margin:0 auto;padding:.85rem .85rem 2rem}

/* DISCLAIMER BANNER */
.disclaimer{background:var(--surface2);border:1px solid var(--border2);border-radius:var(--r);padding:.55rem .95rem;margin-bottom:.75rem;font-size:.72rem;line-height:1.6;color:var(--text3)}
.disclaimer-text{}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow-sm);margin-bottom:.6rem;overflow:hidden}
.card-pad{padding:.7rem .9rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.search-wrap{position:relative;display:flex;align-items:center}
.s-inp{
  width:100%;padding:.5rem .75rem;padding-right:2.2rem;
  border:1px solid var(--border);border-radius:var(--rs);
  background:var(--surface2);color:var(--text);
  font-family:var(--font);font-size:.85rem;outline:none;
  transition:border-color .15s,box-shadow .15s;
}
.s-inp::placeholder{color:var(--text3)}
.s-inp:focus{border-color:var(--gold);background:var(--surface);box-shadow:0 0 0 3px var(--gold-bg)}
.s-clr{
  position:absolute;right:.5rem;top:50%;transform:translateY(-50%);
  width:22px;height:22px;border-radius:50%;border:none;
  background:var(--surface3);color:var(--text3);cursor:pointer;
  display:none;align-items:center;justify-content:center;
  font-size:.7rem;transition:all .12s;padding:0;line-height:1;
}
.s-clr:hover{background:var(--border2);color:var(--text)}
.s-clr.show{display:flex}
.s-hint{font-size:.68rem;color:var(--text3);margin-top:.3rem;line-height:1.5}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.frows{display:flex;flex-direction:column}
.frow{display:flex;align-items:flex-start;gap:.55rem;padding:.55rem .9rem;border-bottom:1px solid var(--border)}
.frow:last-child{border-bottom:none}
.flabel{
  font-size:.6rem;font-weight:700;letter-spacing:.1em;color:var(--text3);
  text-transform:uppercase;white-space:nowrap;padding-top:.25rem;
  min-width:72px;display:flex;align-items:flex-start;gap:.28rem;flex-shrink:0;
}
.flabel::before{content:'';display:inline-block;width:2px;height:12px;margin-top:.05rem;border-radius:2px;flex-shrink:0}
.flabel.preset::before{background:var(--gold)}
.flabel.idx::before{background:var(--teal)}
.flabel.papan::before{background:var(--amber)}
.flabel.sektor::before{background:var(--blue)}
.flabel.ma::before{background:var(--green)}
.flabel.vol::before{background:var(--blue)}
.flabel.osc::before{background:var(--purple)}
.flabel.price::before{background:var(--blue)}
.price-inputs{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
.price-inp{width:115px;padding:.28rem .5rem;border:1px solid var(--border);border-radius:var(--rs);background:var(--surface2);color:var(--text);font-family:var(--font);font-size:.74rem;outline:none;transition:all .12s}
.price-inp:focus{border-color:var(--blue);background:var(--surface)}
.price-inp::placeholder{color:var(--text3)}
.price-sep{color:var(--text3);font-size:.72rem}


/* chips */
.chips{display:flex;flex-wrap:wrap;gap:.3rem;flex:1}
.chip{
  padding:.22rem .55rem;border-radius:var(--rx);border:1px solid var(--border);
  background:var(--surface);color:var(--text2);font-family:var(--font);
  font-size:.7rem;font-weight:500;cursor:pointer;transition:all .12s;
  user-select:none;line-height:1.35;white-space:nowrap;
}
.chip:hover{background:var(--surface2)}
.chip.idx:hover,.chip.idx.on{border-color:var(--teal);color:var(--teal);background:var(--teal-bg)}
.chip.papan:hover,.chip.papan.on{border-color:var(--amber);color:var(--amber);background:var(--amber-bg)}
.chip.ma:hover,.chip.ma.on{border-color:var(--green);color:var(--green);background:var(--green-bg)}
.chip.vol:hover,.chip.vol.on{border-color:var(--blue);color:var(--blue);background:var(--blue-bg)}
.chip.osc:hover,.chip.osc.on{border-color:var(--purple);color:var(--purple);background:var(--purple-bg)}
.chip.sektor:hover,.chip.sektor.on{border-color:var(--blue);color:var(--blue);background:var(--blue-bg)}

/* PRESET chips â€” larger, bolder, most important */
.preset-chips{display:flex;flex-wrap:wrap;gap:.35rem;flex:1}
.pchip{
  display:inline-flex;align-items:center;gap:.3rem;
  padding:.3rem .7rem;border-radius:var(--rx);border:1.5px solid var(--border);
  background:var(--surface);color:var(--text2);font-family:var(--font);
  font-size:.75rem;font-weight:600;cursor:pointer;transition:all .15s;
  user-select:none;line-height:1.35;white-space:nowrap;letter-spacing:.01em;
}
.pchip:hover{background:var(--surface2);border-color:var(--border2)}
.pchip .pico{font-size:.8rem;line-height:1}
.pchip.p0:hover,.pchip.p0.on{border-color:var(--green);color:var(--green);background:var(--green-bg);box-shadow:0 0 0 1px var(--green-bg)}
.pchip.p1:hover,.pchip.p1.on{border-color:var(--gold);color:var(--gold);background:var(--gold-bg);box-shadow:0 0 0 1px var(--gold-bg)}
.pchip.p2:hover,.pchip.p2.on{border-color:var(--teal);color:var(--teal);background:var(--teal-bg);box-shadow:0 0 0 1px var(--teal-bg)}
.pchip.p3:hover,.pchip.p3.on{border-color:var(--blue);color:var(--blue);background:var(--blue-bg);box-shadow:0 0 0 1px var(--blue-bg)}
.pchip.p4:hover,.pchip.p4.on{border-color:var(--purple);color:var(--purple);background:var(--purple-bg);box-shadow:0 0 0 1px var(--purple-bg)}

/* reset button */
.creset{
  padding:.22rem .6rem;border-radius:var(--rx);border:1.5px dashed var(--border2);
  background:transparent;color:var(--text3);font-family:var(--font);
  font-size:.68rem;font-weight:600;cursor:pointer;transition:all .12s;
  user-select:none;line-height:1.35;white-space:nowrap;letter-spacing:.02em;
}
.creset{
  background:var(--red-bg);border-color:var(--red);color:var(--red);
}
.creset:hover{
  background:var(--red);color:#fff;border-color:var(--red);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats{
  display:flex;align-items:center;gap:.7rem;flex-wrap:wrap;
  padding:.4rem .9rem;border-bottom:1px solid var(--border);font-size:.7rem;
}
.st{display:flex;align-items:center;gap:.2rem;color:var(--text3)}
.st b{color:var(--text);font-weight:700}
.st.g b{color:var(--green)}.st.r b{color:var(--red)}.st.a b{color:var(--gold)}
.src-pill{
  margin-left:auto;display:inline-flex;align-items:center;gap:.25rem;
  padding:.18rem .55rem;border-radius:20px;font-size:.65rem;font-weight:600;
  border:1px solid var(--border);color:var(--text3);background:var(--surface2);
}
.src-pill.gh{background:var(--green-bg);color:var(--green);border-color:rgba(34,197,94,.25)}
.src-pill.cache{background:var(--blue-bg);color:var(--blue);border-color:rgba(96,165,250,.25)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.twrap{overflow-x:auto;-webkit-overflow-scrolling:touch;position:relative}
table{width:100%;border-collapse:collapse;font-size:.73rem}

/* Sticky ticker column */
.csticky{position:sticky;left:0;z-index:10;background:var(--surface)}
tbody tr:hover .csticky{background:var(--surface2)}
.twrap.scrolled .csticky::after{
  content:'';position:absolute;top:0;right:-10px;bottom:0;width:10px;
  background:linear-gradient(to right,rgba(0,0,0,.25),transparent);
  pointer-events:none;
}
[data-theme="light"] .twrap.scrolled .csticky::after{
  background:linear-gradient(to right,rgba(0,0,0,.08),transparent);
}

/* Group header row */
tr.grow th{
  padding:.22rem .55rem;font-size:.57rem;font-weight:700;letter-spacing:.1em;
  text-transform:uppercase;color:var(--text3);background:var(--bg2);
  white-space:nowrap;cursor:default;border-bottom:1px solid var(--border);
  text-align:center;
}
tr.grow th:first-child{text-align:left;padding-left:.9rem}
.gh-score{border-left:2px solid var(--gold);color:var(--gold)!important}
.gh-price{border-left:1px solid var(--border);color:var(--blue)!important}
.gh-trend{border-left:1px solid var(--border);color:var(--green)!important}
.gh-osc{border-left:1px solid var(--border);color:var(--purple)!important}

/* Column header row */
tr.crow th{
  padding:.4rem .55rem;font-size:.65rem;font-weight:600;color:var(--text2);
  background:var(--bg2);white-space:nowrap;cursor:pointer;user-select:none;
  border-bottom:2px solid var(--border);text-align:right;transition:color .12s;
}
tr.crow th:first-child{text-align:left;padding-left:.9rem}
tr.crow th.nc{cursor:default}
tr.crow th:hover:not(.nc){color:var(--text)}
tr.crow th.sa::after{content:' â†‘';color:var(--gold);font-size:.57rem}
tr.crow th.sd::after{content:' â†“';color:var(--gold);font-size:.57rem}
.ch-score{border-left:2px solid var(--gold)}
.ch-price{border-left:1px solid var(--border)}
.ch-trend{border-left:1px solid var(--border)}
.ch-osc{border-left:1px solid var(--border)}

/* Body */
tbody tr{border-bottom:1px solid var(--border);transition:background .07s}
tbody tr:hover{background:var(--surface2)}
tbody tr:last-child{border-bottom:none}
tbody td{padding:.42rem .55rem;white-space:nowrap;vertical-align:middle;text-align:right}
tbody td:first-child{padding-left:.9rem;text-align:left}
.bd-score{border-left:2px solid var(--gold)}
.bd-price{border-left:1px solid var(--border)}
.bd-trend{border-left:1px solid var(--border)}
.bd-osc{border-left:1px solid var(--border)}

/* â”€â”€ TICKER CELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ctk{font-family:var(--mono);font-weight:600;font-size:.8rem;line-height:1.2}
.ctk a{color:var(--gold);transition:color .1s}
.ctk a:hover{color:var(--gold-h)}
.cco{font-size:.67rem;color:var(--text3);max-width:145px;overflow:hidden;text-overflow:ellipsis;line-height:1.3;margin-top:1px}
.cmeta{display:flex;flex-wrap:wrap;gap:.18rem;margin-top:3px}
.bpapan{display:inline-block;font-size:.57rem;font-weight:600;padding:.04rem .28rem;border-radius:3px;color:var(--amber);background:var(--amber-bg);letter-spacing:.02em;line-height:1.45}
.bidx{display:inline-block;font-size:.57rem;font-weight:600;padding:.04rem .28rem;border-radius:3px;color:var(--teal);background:var(--teal-bg);letter-spacing:.02em;line-height:1.45}
.bsektor{display:inline-block;font-size:.57rem;font-weight:600;padding:.04rem .28rem;border-radius:3px;color:var(--blue);background:var(--blue-bg);letter-spacing:.02em;line-height:1.45}

/* â”€â”€ SCORE CELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.score-badge{
  display:inline-flex;align-items:center;justify-content:center;
  width:2.6rem;height:1.7rem;border-radius:var(--rs);
  font-family:var(--mono);font-size:.75rem;font-weight:700;letter-spacing:-.01em;
}
.score-badge.sh{background:var(--score-hi-bg);color:var(--score-hi);border:1px solid rgba(34,197,94,.2)}
.score-badge.sm{background:var(--score-md-bg);color:var(--score-md);border:1px solid rgba(45,212,191,.2)}
.score-badge.sl{background:var(--score-lo-bg);color:var(--score-lo);border:1px solid rgba(245,158,11,.2)}
.score-badge.sv{background:var(--score-vlo-bg);color:var(--score-vlo);border:1px solid rgba(75,85,99,.2)}
.score-lbl{font-size:.58rem;font-weight:600;margin-top:1px;letter-spacing:.03em;text-align:center;opacity:.85}
.score-cell{display:flex;flex-direction:column;align-items:center;gap:1px}

/* â”€â”€ PRICE CELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cnum{font-family:var(--mono);font-weight:500}
.cnum.lg{font-weight:700;font-size:.8rem}
.up{color:var(--green)}.dn{color:var(--red)}.nu{color:var(--text3)}
.price-cell{display:flex;flex-direction:column;align-items:flex-end;gap:1px}
.pct-badge{
  display:inline-flex;align-items:center;font-family:var(--mono);
  font-size:.64rem;font-weight:600;padding:.06rem .32rem;border-radius:3px;
}
.pct-badge.up{background:var(--green-bg);color:var(--green)}
.pct-badge.dn{background:var(--red-bg);color:var(--red)}
.pct-badge.nu{background:var(--surface3);color:var(--text3)}

/* â”€â”€ TREND CELL (MA dots) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ma-dots{display:flex;gap:2px;justify-content:flex-end;align-items:center}
.ma-dot{
  width:9px;height:9px;border-radius:50%;flex-shrink:0;
  transition:background .15s;
}
.ma-dot.on{background:var(--green)}
.ma-dot.off{background:var(--border2)}
.ma-dot.na{background:var(--border);opacity:.4}
.trend-score{font-family:var(--mono);font-size:.62rem;color:var(--text3);margin-right:.25rem;flex-shrink:0}

/* â”€â”€ VOLUME CELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.vol-bar-wrap{display:flex;align-items:center;gap:.3rem;justify-content:flex-end}
.vol-bar-track{width:36px;height:4px;background:var(--surface3);border-radius:2px;overflow:hidden;flex-shrink:0}
.vol-bar-fill{height:100%;border-radius:2px;transition:width .3s}
.vol-lbl{font-family:var(--mono);font-size:.65rem;min-width:2rem;text-align:right}

/* â”€â”€ RSI / STOCHRSI CELL â€” proper column alignment â”€â”€ */
.osc-cell{
  display:flex;flex-direction:column;align-items:flex-end;gap:3px;
  min-width:58px;
}
.osc-track{width:36px;height:3px;background:var(--surface3);border-radius:2px;overflow:hidden;flex-shrink:0}
.osc-fill{height:100%;border-radius:2px}
.osc-row{display:flex;align-items:center;justify-content:flex-end;gap:.25rem}
.osc-val{font-family:var(--mono);font-size:.72rem;font-weight:600;min-width:1.8rem;text-align:right}
.osc-zone{font-size:.56rem;font-weight:600;min-width:1.2rem;text-align:left;letter-spacing:.02em}

/* â”€â”€ MACD CELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.macd-b{
  display:inline-flex;align-items:center;padding:.17rem .45rem;
  border-radius:var(--rx);font-size:.63rem;font-weight:700;font-family:var(--mono);
  white-space:nowrap;letter-spacing:.01em;
}
.macd-bull{background:var(--green-dim);color:var(--green)}
.macd-bear{background:var(--red-dim);color:var(--red)}
.macd-neu{background:var(--surface3);color:var(--text3)}

/* â”€â”€ ADR CELL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.adr-wrap{display:flex;flex-direction:column;align-items:flex-end;gap:1px}
.adr-pct{font-family:var(--mono);font-size:.71rem;font-weight:600}
.adr-label{font-size:.58rem;color:var(--text3)}

/* â”€â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tempty{padding:3.5rem 1rem;text-align:center;color:var(--text3)}
.tempty-ico{font-size:2rem;margin-bottom:.5rem;opacity:.3}
.tempty-txt{font-size:.82rem;margin-bottom:.25rem;color:var(--text2);font-weight:500}
.tempty-sub{font-size:.7rem}

/* â”€â”€â”€ DEBUG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dbpanel{background:var(--bg2);border:1px solid var(--border);border-radius:var(--rs);padding:.5rem .75rem;margin-bottom:.6rem;font-family:var(--mono);font-size:.62rem;color:var(--text2);max-height:110px;overflow-y:auto;display:none}
.dbpanel.show{display:block}
.dl{padding:1px 0}.dl.ok{color:var(--green)}.dl.err{color:var(--red)}.dl.warn{color:var(--amber)}

/* â”€â”€â”€ TOASTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toasts{position:fixed;bottom:1rem;right:1rem;display:flex;flex-direction:column;gap:.3rem;z-index:999;pointer-events:none}
.toast{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:.45rem .8rem;font-size:.73rem;color:var(--text);box-shadow:var(--shadow);transform:translateX(140%);transition:transform .22s;max-width:240px;pointer-events:auto}
.toast.show{transform:translateX(0)}
.toast.ok{border-left:3px solid var(--green)}
.toast.er{border-left:3px solid var(--red)}
.toast.in{border-left:3px solid var(--gold)}

/* â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.footer{font-size:.65rem;color:var(--text3);text-align:center;padding-bottom:1.5rem;line-height:1.7}

/* â”€â”€â”€ HELP POPUP */
.help-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:9998;display:none;align-items:center;justify-content:center;padding:1rem;backdrop-filter:blur(3px)}
.help-overlay.show{display:flex}
.help-popup{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow-lg);max-width:700px;width:100%;max-height:85vh;overflow-y:auto;position:relative}
.help-head{padding:1rem 1.2rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--surface);z-index:10}
.help-title{font-size:1.05rem;font-weight:700;color:var(--text)}
.help-close{background:var(--surface2);border:1px solid var(--border);border-radius:var(--rs);width:28px;height:28px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text3);font-size:.9rem;transition:all .12s}
.help-close:hover{background:var(--border);color:var(--text)}
.help-body{padding:1.2rem 1.2rem 1.5rem}
.help-section{margin-bottom:1.5rem}
.help-section:last-child{margin-bottom:0}
.help-h{font-size:.88rem;font-weight:700;color:var(--gold);margin-bottom:.5rem;letter-spacing:-.01em}
.help-p{font-size:.78rem;line-height:1.7;color:var(--text2);margin-bottom:.6rem}
.help-p:last-child{margin-bottom:0}
.help-p strong{color:var(--text);font-weight:600}
.help-ul{list-style:none;padding-left:0;font-size:.78rem;line-height:1.7;color:var(--text2)}
.help-ul li{padding-left:1.2rem;position:relative;margin-bottom:.4rem}
.help-ul li::before{content:'â€¢';position:absolute;left:.3rem;color:var(--gold);font-weight:700}
.help-formula{background:var(--surface2);border:1px solid var(--border);border-radius:var(--rs);padding:.6rem .8rem;font-family:var(--font);font-size:.76rem;color:var(--text);margin:.5rem 0;line-height:1.6}

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:768px){
  .hide-mobile{display:none !important}
}
@media(max-width:720px){
  .topbar-meta .meta-pill:not(:first-child){display:none}
  .page{padding:.5rem .5rem 2rem}
  .frow{flex-direction:column;gap:.3rem;padding:.5rem .65rem}
  .flabel{min-width:unset;padding-top:0}
  html{font-size:16.5px}
}
@media(max-width:480px){
  .brand-sub{display:none}
  .tbtn .tlbl{display:none}
}

@keyframes slideIn{from{transform:translateX(150%)}to{transform:translateX(0)}}

/* VMA volume filter chips use .chip.vol styles defined above */

/* Hide non-critical columns on mobile â€” handled by responsive rules above */

/* Compact table design */
table { font-size: 0.76rem; }
tbody td { padding: 0.42rem 0.5rem; }
thead th { padding: 0.42rem 0.5rem; }
.score-badge { width: 2.5rem; height: 1.55rem; font-size: 0.72rem; }
.ma-dot { width: 8px; height: 8px; }
.ctk { font-size: 0.82rem; }
.cco { font-size: 0.68rem; max-width: 135px; }
.bpapan, .bidx, .bsektor { font-size: 0.56rem; padding: 0.04rem 0.24rem; }

/* Remove vertical borders between columns */
.bd-score, .bd-price, .bd-trend, .bd-osc,
.ch-score, .ch-price, .ch-trend, .ch-osc,
.gh-score, .gh-price, .gh-trend, .gh-osc {
  border-left: none !important;
}

.chip.price:hover,.chip.price.on{
  border-color:var(--gold);color:var(--gold);background:var(--gold-bg);box-shadow:0 0 0 1px var(--gold-bg);
}

/* Ticker links use theme-aware gold color defined in .ctk a above */

</style>
  <script src="stocks_database.js"></script>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <div class="brand">
    <div>
      <div class="brand-text">Screener Saham</div>
      <div class="brand-sub">Indonesia</div>
    </div>
  </div>
  <div class="topbar-meta">
    <div class="meta-pill"><span class="dot" id="sDot"></span><span id="sText">Memuatâ€¦</span></div>
    <div class="meta-pill" id="tsPill" style="display:none"><span id="tsText"></span></div>
  </div>
  <div class="topbar-r">
    <button class="tbtn" id="dbBtn" onclick="toggleDebug()">
      <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
      <span class="tlbl">Log</span>
    </button>
    <button class="tbtn" onclick="toggleTheme()" id="themeBtn">
      <span id="themeIco">â˜€ï¸</span>
      <span class="tlbl" id="themeLbl">Light</span>
    </button>
  </div>
</header>
<div class="pbar"><div class="pbar-fill" id="prog"></div></div>

<div class="page">
  <!-- DISCLAIMER BANNER -->
  <div class="disclaimer">
    <div class="disclaimer-text">
      Data dari Yahoo Finance, update 3x/hari: 09:10 WIB, 12:10 WIB, 17:30 WIB. Situs ini bukan rekomendasi investasi. Analisis teknikal ini adalah alat bantu pribadi. Risiko trading sepenuhnya tanggung jawab pengguna.
    </div>
  </div>

  <div class="dbpanel" id="dbPanel"><div id="dbLog"></div></div>

  <!-- SEARCH -->
  <div class="card"><div class="card-pad">
    <div class="search-wrap">
      <input class="s-inp" id="sInp" placeholder="Cari ticker atau nama perusahaanâ€¦" autocomplete="off" spellcheck="false">
      <button class="s-clr" id="sClr" onclick="clearSearch()" title="Hapus">âœ•</button>
    </div>
    <div class="s-hint">Tip: Bisa cari multiple ticker â€” pisah dengan spasi (contoh: BBCA BBRI GOTO)</div>
  </div></div>

  <!-- FILTERS -->
  <div class="card"><div class="frows">

    <!-- ROW 1: PRESET SETUPS â€” most important, top of filter -->
    <div class="frow">
      <span class="flabel preset">Setup</span>
      <div class="preset-chips">
        <button class="pchip p0" id="ps-breakout" onclick="togglePreset('breakout')">
          <span class="pico">ğŸš€</span> Siap Breakout
        </button>
        <button class="pchip p1" id="ps-uptrend" onclick="togglePreset('uptrend')">
          <span class="pico">ğŸ“ˆ</span> Uptrend Kuat
        </button>
        <button class="pchip p2" id="ps-momentum" onclick="togglePreset('momentum')">
          <span class="pico">âš¡</span> Momentum Naik
        </button>
        <button class="pchip p3" id="ps-volspike" onclick="togglePreset('volspike')">
          <span class="pico">ğŸ”Š</span> Volume Spike
        </button>
        <button class="pchip p4" id="ps-oversold" onclick="togglePreset('oversold')">
          <span class="pico">ğŸ”</span> Jenuh Jual
        </button>
        <button class="creset" onclick="resetAll()">â†º Reset Semua</button>
      </div>
    </div>

    <!-- ROW 2: INDEX FILTER -->
    <div class="frow">
      <span class="flabel idx">Indeks</span>
      <div class="chips">
        <span class="chip idx" id="if-issi"      onclick="toggleIF('issi')">ISSI</span>
        <span class="chip idx" id="if-lq45"      onclick="toggleIF('lq45')">LQ45</span>
        <span class="chip idx" id="if-k100"      onclick="toggleIF('k100')">KOMPAS100</span>
        <span class="chip idx" id="if-bumn"      onclick="toggleIF('bumn')">BUMN</span>
        <button class="creset" onclick="resetIF()">â†º</button>
      </div>
    </div>

    <!-- ROW 3: PAPAN FILTER -->
    <div class="frow">
      <span class="flabel papan">Papan</span>
      <div class="chips">
        <span class="chip papan" id="pf-utama"  onclick="togglePF('utama')">Utama</span>
        <span class="chip papan" id="pf-dev"    onclick="togglePF('dev')">Pengembangan</span>
        <span class="chip papan" id="pf-aksel"  onclick="togglePF('aksel')">Akselerasi</span>
        <span class="chip papan" id="pf-enb"    onclick="togglePF('enb')">Ekonomi Baru</span>
        <span class="chip papan" id="pf-pkm"    onclick="togglePF('pkm')">Pmnt. Khusus</span>
        <button class="creset" onclick="resetPF()">â†º</button>
      </div>
    </div>

    <!-- ROW 4: MA FILTER (power user) -->
    
    <!-- FRAKSI PRICE FILTER -->
    <!-- SEKTOR FILTER â€” uses data-sektor for reliable matching -->
    <div class="frow">
      <span class="flabel sektor">Sektor</span>
      <div class="chips" id="sektorChips">
        <span class="chip sektor" data-sektor="Bahan Baku" onclick="toggleSF(this)">Bahan Baku</span>
        <span class="chip sektor" data-sektor="Consumer" onclick="toggleSF(this)">Consumer</span>
        <span class="chip sektor" data-sektor="Energi" onclick="toggleSF(this)">Energi</span>
        <span class="chip sektor" data-sektor="Industri" onclick="toggleSF(this)">Industri</span>
        <span class="chip sektor" data-sektor="Infrastruktur" onclick="toggleSF(this)">Infrastruktur</span>
        <span class="chip sektor" data-sektor="Kesehatan" onclick="toggleSF(this)">Kesehatan</span>
        <span class="chip sektor" data-sektor="Keuangan" onclick="toggleSF(this)">Keuangan</span>
        <span class="chip sektor" data-sektor="Properti" onclick="toggleSF(this)">Properti</span>
        <span class="chip sektor" data-sektor="Siklikal" onclick="toggleSF(this)">Siklikal</span>
        <span class="chip sektor" data-sektor="Teknologi" onclick="toggleSF(this)">Teknologi</span>
        <span class="chip sektor" data-sektor="Transportasi" onclick="toggleSF(this)">Transportasi</span>
        <button class="creset" onclick="resetSF()">â†º</button>
      </div>
    </div>

    <div class="frow">
      <span class="flabel price">Harga</span>
      <div class="chips">
        <span class="chip price" id="frak-1" onclick="toggleFrak('1')" title="< Rp 200">< 200</span>
        <span class="chip price" id="frak-2" onclick="toggleFrak('2')" title="Rp 200-500">200-500</span>
        <span class="chip price" id="frak-5" onclick="toggleFrak('5')" title="Rp 500-2K">500-2K</span>
        <span class="chip price" id="frak-10" onclick="toggleFrak('10')" title="Rp 2K-5K">2K-5K</span>
        <span class="chip price" id="frak-25" onclick="toggleFrak('25')" title="> Rp 5K">> 5K</span>
        <button class="creset" onclick="resetFrak()">â†º</button>
      </div>
    </div>

<div class="frow">
      <span class="flabel ma">MA</span>
      <div class="chips">
        <span class="chip ma" id="mf-ema3"   onclick="toggleMF('ema3')">EMA 3</span>
        <span class="chip ma" id="mf-ema5"   onclick="toggleMF('ema5')">EMA 5</span>
        <span class="chip ma" id="mf-ema10"  onclick="toggleMF('ema10')">EMA 10</span>
        <span class="chip ma" id="mf-ema20"  onclick="toggleMF('ema20')">EMA 20</span>
        <span class="chip ma" id="mf-sma50"  onclick="toggleMF('sma50')">SMA 50</span>
        <span class="chip ma" id="mf-sma100" onclick="toggleMF('sma100')">SMA 100</span>
        <span class="chip ma" id="mf-sma200" onclick="toggleMF('sma200')">SMA 200</span>
        <button class="creset" onclick="resetMF()">â†º</button>
      </div>
    </div>

    <!-- ROW 5: OSCILLATOR FILTER (power user) -->
    <div class="frow" style="border-bottom:none">
      <span class="flabel osc">Osilator</span>
      <div class="chips">
        <span class="chip osc" id="of-rsi-sweet"  onclick="toggleOF('rsi-sweet')"  title="RSI 50â€“70: zona sweet spot untuk entry long">RSI Sweet Spot (50â€“70)</span>
        <span class="chip osc" id="of-rsi-os"     onclick="toggleOF('rsi-os')"     title="RSI di bawah 35: potensi rebound dari jenuh jual">RSI Jenuh Jual (&lt;35)</span>
        <span class="chip osc" id="of-rsi-bull"   onclick="toggleOF('rsi-bull')"   title="RSI di atas 50: momentum bullish aktif">RSI Bullish (&gt;50)</span>
        <span class="chip osc" id="of-macd-bull"  onclick="toggleOF('macd-bull')"  title="Histogram MACD positif: momentum naik">MACD Bullish</span>
        <span class="chip osc" id="of-macd-cross" onclick="toggleOF('macd-cross')" title="MACD baru saja crossing ke atas sinyal">MACD Baru Bullish</span>
        <button class="creset" onclick="resetOF()">â†º</button>
      </div>
    </div>

  </div></div>

  <!-- TABLE CARD -->
  <div class="card">
    <div class="stats" id="statsBar" style="display:none">
      <span class="st">Tampil: <b id="s-sho">0</b></span>
      <span class="st">Total: <b id="s-tot">0</b></span>
      <span class="st g">Skor â‰¥8: <b id="s-hi">0</b></span>
      <span class="st a">Uptrend: <b id="s-up">0</b></span>
      <span class="st r">Bearish: <b id="s-dn">0</b></span>
      <span class="src-pill" id="srcPill" style="display:none"></span>
    </div>

    <div class="twrap" id="tWrap">
      <table>
        <thead>
          <tr class="crow">
            <th class="nc csticky" title="Kode saham (klik untuk buka chart di TradingView)">Ticker</th>
            <th onclick="sortBy('score')" title="Skor setup 0â€“10: MAÃ—7 + RSIÃ—1.5 + MACDÃ—1 + VolÃ—0.5">Skor Setup</th>
            <th onclick="sortBy('price')" title="Harga penutupan terakhir">Harga</th>
            <th onclick="sortBy('pct')" title="Perubahan harga hari ini (%)">% Chg</th>
            <th onclick="sortBy('pct1today')" title="1% dari nilai transaksi hari ini untuk entry position">1% Transaksi Harian</th>
            <th class="nc" title="Harga di atas MA mana? (E3/E5/E10/E20, S50/S100/S200)">MA (7)</th>
            <th class="nc" title="Volume hari ini vs VMA (V3/V5/V10/V20/V50/V100/V200)">Vol (7)</th>
            <th onclick="sortBy('rsi')" title="RSI(14): <35 jenuh jual, 50-70 sweet spot, >80 jenuh beli">RSI</th>
            <th onclick="sortBy('stochRsi')" class="hide-mobile" title="Stochastic RSI: momentum sensitif">StochRSI</th>
            <th onclick="sortBy('macdHist')" title="MACD histogram">MACD</th>
            <th onclick="sortBy('atrV')" class="hide-mobile" title="Average True Range untuk stop loss">ATR</th>
            <th onclick="sortBy('adrPct')" title="Average Daily Range: gerak harian rata-rata">ADR</th>
          </tr>
        </thead>
        <tbody id="tBody">
          <tr><td colspan="12"><div class="tempty"><div class="tempty-ico">ğŸ“Š</div><div class="tempty-txt">Memuat dataâ€¦</div></div></td></tr>
        </tbody>
      </table>
    </div>
  </div>

  
<!-- HELP POPUP -->
<div class="help-overlay" id="helpOverlay" onclick="if(event.target===this)hideHelp()">
  <div class="help-popup">
    <div class="help-head">
      <div class="help-title">ğŸ“š Keterangan & Penjelasan Istilah</div>
      <button class="help-close" onclick="hideHelp()">âœ•</button>
    </div>
    <div class="help-body">
      
      <div class="help-section">
        <div class="help-h">ğŸ¯ Skor Setup (0â€“10)</div>
        <div class="help-p">Skor otomatis yang menggabungkan semua indikator teknikal utama. Semakin tinggi skor = semakin kuat setup bullish.</div>
        <div class="help-formula">
          <strong>Formula:</strong><br>
          â€¢ MA Alignment (7 pts): +1 untuk setiap MA yang price di atasnya (EMA3/5/10/20 + SMA50/100/200)<br>
          â€¢ RSI Sweet Spot (1.5 pts): RSI 50â€“70 = +1.5 | RSI 70â€“80 = +0.5 | RSI 40â€“50 = +0.5<br>
          â€¢ MACD Bullish (1 pt): Histogram positif = +1<br>
          â€¢ Volume Aktif (0.5 pt): Volume > VMA20 = +0.5
        </div>
        <div class="help-p"><strong>KUAT (â‰¥8)</strong> = setup siap breakout | <strong>BAGUS (6â€“7.9)</strong> = uptrend aktif | <strong>PANTAU (4â€“5.9)</strong> = momentum sedang bangun | <strong>LEMAH (<4)</strong> = belum setup</div>
      </div>

      <div class="help-section">
        <div class="help-h">ğŸš€ Preset Setup â€” One-Tap Filters</div>
        <ul class="help-ul">
          <li><strong>Siap Breakout:</strong> EMA5âœ“ + EMA20âœ“ + RSI 50â€“70 + MACD Bull + Vol>VMA20 â€” kandidat paling siap naik</li>
          <li><strong>Uptrend Kuat:</strong> 5+ dari 7 MAâœ“ + MACD Bull + EMA20âœ“ â€” trend sudah established, ride the wave</li>
          <li><strong>Momentum Naik:</strong> RSI 55â€“75 + MACD Bull + EMA20âœ“ â€” RSI-driven momentum plays</li>
          <li><strong>Volume Spike:</strong> Vol > VMA3+5+20 + EMA20âœ“ â€” ada aktivitas unusual, bisa jadi smart money masuk</li>
          <li><strong>Jenuh Jual:</strong> RSI <35 â€” oversold bounce candidates</li>
        </ul>
      </div>

      <div class="help-section">
        <div class="help-h">ğŸ“Š Kolom Tabel â€” Penjelasan</div>
        <ul class="help-ul">
          <li><strong>MA (7):</strong> Jumlah MA yang price di atasnya. 7 titik hijau = bullish sempurna (price di atas semua MA). Semakin banyak hijau = trend semakin kuat.</li>
          <li><strong>Volume:</strong> Bar menunjukkan volume hari ini vs rata-rata (VMA3/5/20/50). <strong>Sangat Tinggi</strong> = semua 4 VMA terkalahkan (unusual activity) | <strong>Tinggi</strong> = 3 VMA | <strong>Cukup</strong> = 2 VMA | <strong>Rendah</strong> = 0â€“1 VMA.</li>
          <li><strong>RSI:</strong> Relative Strength Index (14 periode). <strong>JS (Jenuh Jual, <20)</strong> = oversold extreme | <strong>OK (50â€“70)</strong> = sweet spot entry zone | <strong>OB (70â€“80)</strong> = overbought tapi masih bisa lanjut | <strong>JB (>80)</strong> = jenuh beli extreme.</li>
          <li><strong>MACD:</strong> â–² Bull = histogram positif (momentum naik) | â–¼ Bear = histogram negatif (momentum turun) | âœ¦ = baru saja crossing (fresh signal).</li>
          <li><strong>Gerak/H (ADR%):</strong> Average Daily Range % â€” rata-rata pergerakan harian dalam 14 hari terakhir. <strong>Aktif (â‰¥5%)</strong> = volatil, banyak peluang | <strong>Normal (2.5â€“5%)</strong> | <strong>Lesu (<1.5%)</strong> = kurang gerak, susah profit.</li>
          <li><strong>1% Trx:</strong> 1% dari nilai transaksi hari terakhir (Volume Ã— Price Ã— 0.01). Berguna untuk estimasi modal minimal atau target profit 1%.</li>
        </ul>
      </div>

      <div class="help-section">
        <div class="help-h">ğŸ” Filter Indeks (Mode AND)</div>
        <div class="help-p">Filter indeks sekarang pakai logika <strong>AND</strong> â€” saham harus punya <strong>semua tag yang dipilih</strong>. Contoh: pilih LQ45 + ISSI â†’ hanya saham yang masuk <strong>kedua indeks</strong> akan muncul.</div>
        <div class="help-p">Gunakan ini untuk cari saham blue-chip likuid (LQ45 + ISSI) atau saham BUMN syariah (BUMN + ISSI).</div>
      </div>

      <div class="help-section">
        <div class="help-h">ğŸ’¡ Tips Penggunaan</div>
        <ul class="help-ul">
          <li>Gunakan <strong>Preset</strong> untuk quick scan harian â€” paling praktis.</li>
          <li>Kombinasi filter: contoh "Siap Breakout" + Papan Utama + Harga >1000 untuk cari saham liquid berkualitas.</li>
          <li>Search support <strong>multiple ticker</strong> (pisah spasi): ketik "BBCA BBRI TLKM" untuk pantau portfolio.</li>
          <li>Klik header kolom untuk sort â€” default sort by Skor (tertinggi di atas).</li>
          <li>Filter Harga: pakai Min untuk hindari saham gorengan murah, Max untuk cari mid-cap terjangkau.</li>
        </ul>
      </div>

      <div class="help-section">
        <div class="help-h">âš ï¸ Catatan Penting</div>
        <div class="help-p"><strong>Data update 3x/hari:</strong> 09:00, 12:00, 17:30 WIB via GitHub Actions. Data diambil dari Yahoo Finance.</div>
        <div class="help-p"><strong>Bukan rekomendasi investasi.</strong> Screener ini hanya alat bantu analisis teknikal. Keputusan trading sepenuhnya tanggung jawab Anda. Selalu lakukan riset fundamental, perhatikan manajemen risiko, dan jangan trade dengan uang yang tidak bisa Anda rugikan.</div>
      </div>

    </div>
  </div>
</div>

<div class="footer">
    Data dari Yahoo Finance via GitHub Actions Â· <strong>Bukan rekomendasi investasi</strong><br>
    Preset: ğŸš€ Siap Breakout = EMA20âœ“ + RSI 50â€“70 + MACD Bull + Vol aktif &nbsp;Â·&nbsp;
    ğŸ“ˆ Uptrend Kuat = 5/7 MAâœ“ + MACD Bull &nbsp;Â·&nbsp;
    ğŸ” Jenuh Jual = RSI &lt;35
  </div>
</div>
<div class="toasts" id="toasts"></div>

<script>

// Database loaded from external file
// See: stocks_database.js for structure and documentation

const DATA_URL = 'data/issi_data.json';
const SK = 'scr2_v1', SKT = 'scr2_v1_ts';

// Initialize global arrays
let AD = [];
let DD = [];
let activePreset=null;
let idxF=new Set(), papanF=new Set(), maF=new Set(), oscF=new Set();
let sCol='score', sDir=-1, dbOn=false;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function(){
  const t=localStorage.getItem('scr2_theme')||'dark';
  document.documentElement.setAttribute('data-theme',t);
  _updTheme(t);
})();
function toggleTheme(){
  const cur=document.documentElement.getAttribute('data-theme');
  const n=cur==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme',n);
  localStorage.setItem('scr2_theme',n);
  _updTheme(n);
}
function _updTheme(t){
  document.getElementById('themeIco').textContent=t==='dark'?'â˜€ï¸':'ğŸŒ™';
  document.getElementById('themeLbl').textContent=t==='dark'?'Light':'Dark';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DEBUG
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _dbl=[];
function dLog(m,t=''){
  _dbl.push({m,t});if(_dbl.length>80)_dbl.shift();
  if(!dbOn)return;
  _renderDbLog();
}
function _renderDbLog(){
  const el=document.getElementById('dbLog');
  el.innerHTML=_dbl.slice(-30).map(l=>`<div class="dl ${l.t}">${l.m}</div>`).join('');
  el.scrollTop=el.scrollHeight;
}
function toggleDebug(){
  dbOn=!dbOn;
  document.getElementById('dbPanel').classList.toggle('show',dbOn);
  document.getElementById('dbBtn').classList.toggle('active',dbOn);
  if(dbOn)_renderDbLog();
}

function showHelp(){document.getElementById('helpOverlay').classList.add('show')}
function hideHelp(){document.getElementById('helpOverlay').classList.remove('show')}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MATH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function _ema(a,p){if(!a||a.length<p)return null;const k=2/(p+1);let v=a.slice(0,p).reduce((x,y)=>x+y,0)/p;for(let i=p;i<a.length;i++)v=a[i]*k+v*(1-k);return v}
function _sma(a,p){if(!a||a.length<p)return null;return a.slice(-p).reduce((x,y)=>x+y,0)/p}
function _rsi(a){if(!a||a.length<15)return null;const s=a.slice(-15);let g=0,l=0;for(let i=1;i<s.length;i++){const d=s[i]-s[i-1];if(d>0)g+=d;else l-=d}const ag=g/14,al=l/14;return al===0?100:100-100/(1+ag/al)}
function _stochRSI(a){if(!a||a.length<33)return null;const ra=[];for(let i=15;i<=a.length;i++){const s=a.slice(0,i).slice(-15);let g=0,l=0;for(let j=1;j<s.length;j++){const d=s[j]-s[j-1];if(d>0)g+=d;else l-=d}const ag=g/14,al=l/14;ra.push(al===0?100:100-100/(1+ag/al))}if(ra.length<14)return null;const rec=ra.slice(-14),mn=Math.min(...rec),mx=Math.max(...rec);return mx===mn?50:((ra[ra.length-1]-mn)/(mx-mn))*100}
function _macd(a){if(!a||a.length<35)return null;const lines=[];for(let i=26;i<=a.length;i++){const sl=a.slice(0,i),m12=_ema(sl,12),m26=_ema(sl,26);if(m12!==null&&m26!==null)lines.push(m12-m26)}if(lines.length<9)return null;const sig=_ema(lines,9);if(sig===null)return null;const line=lines.at(-1),hist=line-sig;let ph=null;if(lines.length>=2){const pl=lines.slice(0,-1),ps=_ema(pl,9);if(ps!==null)ph=pl.at(-1)-ps}return{line,signal:sig,hist,bull:hist>0,cross:ph!==null&&Math.sign(hist)!==Math.sign(ph)}}
function _atr(rows){if(!rows||rows.length<15)return null;const trs=[];for(let i=1;i<rows.length;i++)trs.push(Math.max(rows[i].h-rows[i].l,Math.abs(rows[i].h-rows[i-1].c),Math.abs(rows[i].l-rows[i-1].c)));return trs.length>=14?trs.slice(-14).reduce((a,b)=>a+b,0)/14:null}
function _adr(rows){if(!rows||rows.length<14)return null;const r=rows.slice(-14);return{nom:r.reduce((a,b)=>a+(b.h-b.l),0)/14,pct:r.reduce((a,b)=>a+(b.h-b.l)/b.l,0)/14*100}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETUP SCORE (0â€“10)
   MA alignment: 7 pts | RSI zone: 1.5 pts
   MACD bull: 1 pt     | Volume active: 0.5 pt
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function calcScore(d){
  let s=0;
  const ms=d.maStatus||{};
  // MA alignment â€” 7 points total
  ['ema3','ema5','ema10','ema20','sma50','sma100','sma200'].forEach(k=>{if(ms[k])s+=1});
  // RSI sweet spot â€” max 1.5
  if(d.rsi!=null){
    if(d.rsi>=50&&d.rsi<=70) s+=1.5;       // sweet spot âœ“
    else if(d.rsi>70&&d.rsi<=80) s+=0.5;   // slightly overbought
    else if(d.rsi>=40&&d.rsi<50) s+=0.5;   // building momentum
  }
  // MACD histogram positive â€” 1 point
  if(d.macdBull===true) s+=1;
  // Volume above VMA20 â€” 0.5 point
  if(ms.vma20) s+=0.5;
  return Math.min(10, Math.round(s*10)/10);
}

function scoreLabel(s){
  if(s>=8)return{lbl:'KUAT',cls:'sh'};
  if(s>=6)return{lbl:'BAGUS',cls:'sm'};
  if(s>=4)return{lbl:'PANTAU',cls:'sl'};
  return{lbl:'LEMAH',cls:'sv'};
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRESET DEFINITIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PRESETS={
  breakout: d=>{
    const ms=d.maStatus||{};
    return ms.ema20&&ms.ema5&&d.rsi!=null&&d.rsi>=50&&d.rsi<=70&&d.macdBull===true&&ms.vma20;
  },
  uptrend: d=>{
    const ms=d.maStatus||{};
    const maCnt=['ema3','ema5','ema10','ema20','sma50','sma100','sma200'].filter(k=>ms[k]).length;
    return maCnt>=5&&d.macdBull===true&&ms.ema20;
  },
  momentum: d=>{
    const ms=d.maStatus||{};
    return d.rsi!=null&&d.rsi>=55&&d.rsi<=75&&d.macdBull===true&&ms.ema20;
  },
  volspike: d=>{
    const ms=d.maStatus||{};
    return ms.vma3&&ms.vma5&&ms.vma20&&ms.ema20;
  },
  oversold: d=>{
    return d.rsi!=null&&d.rsi<35;
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA ENRICHMENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function _enrich(data){
  return data.map(d=>{
    const tm=TM[d.ticker]||{};
    const score=calcScore(d);
    return {...d, papan:tm.p||d.papan||'',indeks:tm.i||d.indeks||[],sektor:tm.s||'',score};
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA LOADING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// Ensure DOM is ready before any operations
if (document.readyState === 'loading') {
  console.warn('DOM not ready yet, deferring initialization...');
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM ready, safe to proceed');
  });
}

window.addEventListener('load',async()=>{
  try{
    dLog('Loading issi_data.jsonâ€¦');
    const res=await fetch(DATA_URL+'?_='+Date.now());
    if(res.ok){
      const j=await res.json();
      if(j?.data?.length>0){
        const enriched=_enrich(j.data);
        try{localStorage.setItem(SK,JSON.stringify(enriched));localStorage.setItem(SKT,j.fetchedAt||Date.now())}catch(_){}
        _load(enriched,new Date(j.fetchedAt||Date.now()).getTime(),'gh',j.fetchedTimeWIB||j.fetchedAtWIB||'â€”');
        dLog(`GitHub OK: ${enriched.length} saham`,'ok');
        return;
      }
    }
    dLog('GitHub response empty','warn');
  }catch(e){dLog('GitHub fail: '+e.message,'warn')}
  try{
    const raw=localStorage.getItem(SK),ts=localStorage.getItem(SKT);
    if(raw){
      const data=JSON.parse(raw);
      if(data?.length>0){
        const enriched=_enrich(data);
        _load(enriched,ts?parseInt(ts):Date.now(),'cache');
        dLog(`Cache: ${enriched.length} saham`,'ok');
        return;
      }
    }
  }catch(e){dLog('Cache error: '+e.message,'err')}
  setDot('');
  document.getElementById('sText').textContent='Data belum tersedia â€” jalankan GitHub Action terlebih dahulu';
  toast('Data tidak tersedia. Jalankan workflow GitHub Actions.','er');
});


/* Visual feedback handled by topbar dot */

function _load(data,ts,src,ghLabel){
  AD=data;
  document.getElementById('sText').textContent='Online';
  document.getElementById('tsPill').style.display='flex';
  if(src==='gh' && ghLabel){
    // ghLabel is now clean like "17.30 WIB" from fetchedTimeWIB, or fallback locale string
    const isClean=/^\d{2}\.\d{2}\s*WIB$/i.test(ghLabel);
    document.getElementById('tsText').textContent=isClean?'Update Data Jam '+ghLabel:'Update Data Jam '+ghLabel;
  }else{
    document.getElementById('tsText').textContent='Cache \u00B7 '+_ago(ts);
  }
  document.getElementById('statsBar').style.display='flex';
  document.getElementById('srcPill').style.display='none';
  setDot('ok');
  _updateStats();
  applyF();
  renderT();
  
  setTimeout(function() {
    if(!document.getElementById('tBody').innerHTML.includes('ctk')) {
      renderT();
    }
  }, 100);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('sInp').addEventListener('input',function(){
  document.getElementById('sClr').classList.toggle('show',this.value.length>0);
  applyF();renderT();
});
function clearSearch(){
  const sInp=document.getElementById('sInp');if(sInp)sInp.value='';
  document.getElementById('sClr').classList.remove('show');
  applyF();renderT();
  document.getElementById('sInp').focus();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLL SHADOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('tWrap').addEventListener('scroll',function(){
  this.classList.toggle('scrolled',this.scrollLeft>4);
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER MAPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const IDX_MAP ={issi:'ISSI',lq45:'LQ45',k100:'KOMPAS100',bumn:'BUMN'};
const PAPAN_MAP={utama:'Utama',dev:'Pengembangan',aksel:'Akselerasi',enb:'Ekonomi Baru',pkm:'Pemantauan Khusus'};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRESET TOGGLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function togglePreset(key){
  if(activePreset===key){
    activePreset=null;
    document.getElementById('ps-'+key).classList.remove('on');
  }else{
    if(activePreset)document.getElementById('ps-'+activePreset).classList.remove('on');
    activePreset=key;
    document.getElementById('ps-'+key).classList.add('on');
  }
  applyF();renderT();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILTER TOGGLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleIF(k){idxF.has(k)?idxF.delete(k):idxF.add(k);document.getElementById('if-'+k).classList.toggle('on',idxF.has(k));applyF();renderT()}
function togglePF(k){papanF.has(k)?papanF.delete(k):papanF.add(k);document.getElementById('pf-'+k).classList.toggle('on',papanF.has(k));applyF();renderT()}
function toggleMF(k){maF.has(k)?maF.delete(k):maF.add(k);document.getElementById('mf-'+k).classList.toggle('on',maF.has(k));applyF();renderT()}
function toggleOF(k){oscF.has(k)?oscF.delete(k):oscF.add(k);document.getElementById('of-'+k).classList.toggle('on',oscF.has(k));applyF();renderT()}

function resetIF(){idxF.clear();Object.keys(IDX_MAP).forEach(k=>document.getElementById('if-'+k).classList.remove('on'));applyF();renderT()}
function resetPF(){papanF.clear();Object.keys(PAPAN_MAP).forEach(k=>document.getElementById('pf-'+k).classList.remove('on'));applyF();renderT()}
function resetMF(){maF.clear();['ema3','ema5','ema10','ema20','sma50','sma100','sma200'].forEach(k=>document.getElementById('mf-'+k).classList.remove('on'));applyF();renderT()}
function resetOF(){oscF.clear();['rsi-sweet','rsi-os','rsi-bull','macd-bull','macd-cross'].forEach(k=>document.getElementById('of-'+k).classList.remove('on'));applyF();renderT()}

function resetPrice(){document.getElementById('priceMin').value='';document.getElementById('priceMax').value='';applyF();renderT()}

function resetAll(){
  if(activePreset){document.getElementById('ps-'+activePreset).classList.remove('on');activePreset=null;}
  resetIF();resetPF();resetSF();resetMF();resetOF();resetPrice();resetFrak();resetVF();
  clearSearch();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APPLY FILTERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FRAKSI PRICE FILTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let frakF = new Set();

function toggleFrak(k) {
  frakF.has(k) ? frakF.delete(k) : frakF.add(k);
  document.getElementById('frak-' + k).classList.toggle('on', frakF.has(k));
  applyF();
  renderT();
}

function resetFrak() {
  frakF.clear();
  ['1', '2', '5', '10', '25'].forEach(k => {
    const el = document.getElementById('frak-' + k);
    if(el) el.classList.remove('on');
  });
  applyF();
  renderT();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VMA VOLUME FILTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let vmaF = new Set();

function toggleVF(k) {
  vmaF.has(k) ? vmaF.delete(k) : vmaF.add(k);
  document.getElementById('vf-' + k).classList.toggle('on', vmaF.has(k));
  applyF();
  renderT();
}

function resetVF() {
  vmaF.clear();
  ['vma3', 'vma5', 'vma10', 'vma20', 'vma50', 'vma200'].forEach(k => {
    const el = document.getElementById('vf-' + k);
    if(el) el.classList.remove('on');
  });
  applyF();
  renderT();
}


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SEKTOR FILTER â€” uses data-sektor attribute for reliable matching
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sektorF = new Set();

function toggleSF(el) {
  const sektor = el.dataset.sektor;
  if(!sektor) return;
  sektorF.has(sektor) ? sektorF.delete(sektor) : sektorF.add(sektor);
  el.classList.toggle('on', sektorF.has(sektor));
  applyF();
  renderT();
}

function resetSF() {
  sektorF.clear();
  document.querySelectorAll('#sektorChips .chip.sektor').forEach(function(el){
    el.classList.remove('on');
  });
  applyF();
  renderT();
}

function applyF(){
  const q=(document.getElementById('sInp')?.value||'').trim().toUpperCase();
  let d=[...AD];

  // Search
  if(q){
    const tickers=q.split(/\s+/).filter(Boolean);
    d=d.filter(x=>{
      return tickers.some(tk=>x.ticker.includes(tk)) || (x.company||'').toUpperCase().includes(q);
    });
  }

  // Preset (exclusive, OR over individual filters when active)
  if(activePreset&&PRESETS[activePreset]){
    d=d.filter(PRESETS[activePreset]);
  }

  // Indeks (OR)
  if(idxF.size>0){
    d=d.filter(x=>{
      const stockIndices=x.indeks||[];
      return[...idxF].every(k=>stockIndices.includes(IDX_MAP[k]));
    });
  }

  // Papan (OR)
  if(papanF.size>0)d=d.filter(x=>[...papanF].some(k=>x.papan===PAPAN_MAP[k]));
  
  // Sektor filter
  if(sektorF.size>0){
    d=d.filter(x=>[...sektorF].some(s=>x.sektor===s));
  }
  
  // Fraksi price filter
  if(frakF.size>0){
    d=d.filter(x=>{
      const p=x.price;
      return[...frakF].some(f=>{
        if(f==='1')return p<200;
        if(f==='2')return p>=200&&p<500;
        if(f==='5')return p>=500&&p<2000;
        if(f==='10')return p>=2000&&p<5000;
        if(f==='25')return p>=5000;
        return false;
      });
    });
  }
  // Price filter
  const minP=parseFloat(document.getElementById('priceMin')?.value||'');
  const maxP=parseFloat(document.getElementById('priceMax')?.value||'');
  if(!isNaN(minP)&&minP>0)d=d.filter(x=>x.price>=minP);
  if(!isNaN(maxP)&&maxP>0)d=d.filter(x=>x.price<=maxP);


  // MA (AND)
  maF.forEach(k=>{d=d.filter(x=>x.maStatus?.[k]===true)});
  
  // VMA volume filter
  vmaF.forEach(k=>{d=d.filter(x=>x.maStatus?.[k]===true)});

  // Oscillator
  if(oscF.has('rsi-sweet')) d=d.filter(x=>x.rsi!=null&&x.rsi>=50&&x.rsi<=70);
  if(oscF.has('rsi-os'))    d=d.filter(x=>x.rsi!=null&&x.rsi<35);
  if(oscF.has('rsi-bull'))  d=d.filter(x=>x.rsi!=null&&x.rsi>50);
  if(oscF.has('macd-bull')) d=d.filter(x=>x.macdBull===true);
  if(oscF.has('macd-cross'))d=d.filter(x=>x.macdCross===true);

  // Sort
  d.sort((a,b)=>{
    let va=a[sCol]??-Infinity, vb=b[sCol]??-Infinity;
    if(sCol==='ticker'){va=a.ticker||'';vb=b.ticker||'';return va.localeCompare(vb)*sDir}
    return(va-vb)*sDir;
  });

  DD=d;
  document.getElementById('s-sho').textContent=d.length;
}

function sortBy(c){
  const th=event.currentTarget;
  if(sCol===c)sDir*=-1;else{sCol=c;sDir=-1}
  document.querySelectorAll('tr.crow th').forEach(t=>t.classList.remove('sa','sd'));
  th.classList.add(sDir===1?'sa':'sd');
  applyF();renderT();
}

function _updateStats(){
  document.getElementById('s-tot').textContent=AD.length;
  document.getElementById('s-hi').textContent=AD.filter(x=>x.score>=8).length;
  const ms=x=>x.maStatus||{};
  document.getElementById('s-up').textContent=AD.filter(x=>ms(x).ema20&&ms(x).sma50).length;
  document.getElementById('s-dn').textContent=AD.filter(x=>!ms(x).ema20&&!ms(x).sma50).length;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORMAT HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function _price(n){if(n==null||isNaN(n))return'â€”';if(n>=1000)return Math.round(n).toLocaleString('id-ID');return n.toFixed(n>=10?0:2)}
function _fmt(n){if(n==null||isNaN(n)||n===0)return'â€”';const a=Math.abs(n);if(a>=1e12)return(n/1e12).toFixed(2)+'T';if(a>=1e9)return(n/1e9).toFixed(2)+'M';if(a>=1e6)return(n/1e6).toFixed(1)+'Jt';if(a>=1e3)return(n/1e3).toFixed(1)+'Rb';return n.toFixed(0)}

function _pct(n){if(n==null||isNaN(n))return'â€”';return(n>=0?'+':'')+n.toFixed(2)+'%'}
function _dec(n,d=1){if(n==null||isNaN(n))return'â€”';return n.toFixed(d)}
function _rsiColor(v){if(v==null)return'var(--text3)';if(v>80||v<20)return'var(--red)';if(v>=50&&v<=70)return'var(--green)';if(v>70)return'var(--amber)';if(v<35)return'var(--teal)';return'var(--text2)'}
function _rsiZoneLabel(v){if(v==null)return'';if(v>80)return'JB';if(v>70)return'OB';if(v>=50&&v<=70)return'OK';if(v>=35)return'â€“';return'JS'}

const MA_KEYS=['ema3','ema5','ema10','ema20','sma50','sma100','sma200'];
const MA_TIPS=['EMA 3','EMA 5','EMA 10','EMA 20','SMA 50','SMA 100','SMA 200'];
const VOL_KEYS=['vma3','vma5','vma20','vma50'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER TABLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderT(){
  const tb=document.getElementById('tBody');
  if(!tb){console.error('ERROR: tBody element not found!');return;}
  if(!DD){console.error('ERROR: DD is undefined!');DD=[];return;}
  if(!DD.length){
    tb.innerHTML=`<tr><td colspan="12"><div class="tempty">
      <div class="tempty-ico">ğŸ”</div>
      <div class="tempty-txt">Tidak ada saham yang cocok</div>
      <div class="tempty-sub">Coba longgarkan filter atau ganti preset</div>
    </div></td></tr>`;
    return;
  }

  tb.innerHTML=DD.map(d=>{
    const tvUrl=`https://www.tradingview.com/chart/?symbol=IDX%3A${d.ticker}`;
    const ms=d.maStatus||{};

    // Score
    const sc=d.score;
    const {lbl:slbl,cls:scls}=scoreLabel(sc);

    // Badges
    const bPapan=d.papan?`<span class="bpapan">${d.papan}</span>`:'';
    const bSektor=d.sektor?`<span class="bsektor">${d.sektor}</span>`:'';
    const bIdx=(d.indeks||[]).filter(x=>x!=='ISSI').map(x=>`<span class="bidx">${x}</span>`).join('');
    const metaRow=(bPapan||bSektor||bIdx)?`<div class="cmeta">${bPapan}${bSektor}${bIdx}</div>`:'';

    // MA dots (7)
    const maDotCount=MA_KEYS.filter(k=>ms[k]).length;
    const maDots=MA_KEYS.map((k,i)=>{
      const v=ms[k];
      return`<span class="ma-dot ${v===true?'on':'off'}" title="${MA_TIPS[i]}"></span>`;
    }).join('');

    // Volume bar (out of 4 VMAs beaten)
    const volCount=VOL_KEYS.filter(k=>ms[k]).length;
    const volPct=volCount/4*100;
    let volColor='var(--border2)';
    if(volCount>=3)volColor='var(--blue)';
    else if(volCount>=2)volColor='var(--teal)';
    else if(volCount>=1)volColor='var(--text3)';
    const volLbl=['Rendah','Rendah','Cukup','Tinggi','Sangat Tinggi'][volCount];

    // RSI
    const rCv=_rsiColor(d.rsi);
    const rP=d.rsi!=null?Math.min(100,Math.max(0,d.rsi)):0;
    const rZone=_rsiZoneLabel(d.rsi);
    
    // Stoch RSI
    const srsi=d.stochRsi;
    const srsiColor=srsi==null?'var(--text3)':srsi>80?'var(--red)':srsi<20?'var(--teal)':'var(--text2)';
    const srsiP=srsi!=null?Math.min(100,Math.max(0,srsi)):0;
    const srsiZone=srsi==null?'':srsi>80?'JB':srsi<20?'JS':'';

    // MACD badge
    let macdHtml='<span class="macd-b macd-neu">â€”</span>';
    if(d.macdBull!==null){
      const cross=d.macdCross?'âœ¦':'';
      macdHtml=d.macdBull
        ?`<span class="macd-b macd-bull" title="Histogram: ${_dec(d.macdHist,2)}">${cross}â–² Bull</span>`
        :`<span class="macd-b macd-bear" title="Histogram: ${_dec(d.macdHist,2)}">${cross}â–¼ Bear</span>`;
    }

    // ADR (daily range%)
    const adrPct=d.adrPct;
    let adrColor='var(--text2)';
    let adrLbl='';
    if(adrPct!=null){
      if(adrPct>=5){adrColor='var(--green)';adrLbl='Aktif'}
      else if(adrPct>=2.5){adrColor='var(--teal)';adrLbl='Normal'}
      else if(adrPct<1.5){adrColor='var(--text3)';adrLbl='Lesu'}
    }
    const pU=d.pct>=0;

    return`<tr>
<td class="csticky">
  <div class="ctk"><a href="${tvUrl}" target="_blank" rel="noopener">${d.ticker}</a></div>
  <div class="cco" title="${d.company||''}">${d.company||'â€”'}</div>
  ${metaRow}
</td>
<td class="bd-score">
  <div class="score-cell">
    <div class="score-badge ${scls}">${sc.toFixed(1)}</div>
    <div class="score-lbl" style="color:var(--score-${scls==='sh'?'hi':scls==='sm'?'md':scls==='sl'?'lo':'vlo'})">${slbl}</div>
  </div>
</td>
<td class="bd-price">
  <div class="price-cell">
    <div class="cnum lg">${_price(d.price)}</div>
  </div>
</td>
<td class="bd-price">
  <span class="pct-badge ${pU?'up':d.pct===0?'nu':'dn'}">${_pct(d.pct)}</span>
</td>
<td class="bd-price">
  <div class="cnum">${_fmt(d.pct1today)}</div>
</td>
<td class="bd-trend">
  <div class="ma-dots">
    <span class="trend-score">${maDotCount}/7</span>
    ${maDots}
  </div>
</td>
<td class="bd-trend">
  <div class="vol-bar-wrap">
    <div class="vol-bar-track"><div class="vol-bar-fill" style="width:${volPct}%;background:${volColor}"></div></div>
    <span class="vol-lbl" style="color:${volColor}">${volLbl}</span>
  </div>
</td>
<td class="bd-osc">
  <div class="osc-cell">
    <div class="osc-track"><div class="osc-fill" style="width:${rP}%;background:${rCv}"></div></div>
    <div class="osc-row">
      <span class="osc-val" style="color:${rCv}">${_dec(d.rsi)}</span>
      <span class="osc-zone" style="color:${rCv}">${rZone}</span>
    </div>
  </div>
</td>
<td class="bd-osc hide-mobile">
  <div class="osc-cell">
    <div class="osc-track"><div class="osc-fill" style="width:${srsiP}%;background:${srsiColor}"></div></div>
    <div class="osc-row">
      <span class="osc-val" style="color:${srsiColor}">${_dec(d.stochRsi)}</span>
      <span class="osc-zone" style="color:${srsiColor}">${srsiZone}</span>
    </div>
  </div>
</td>
<td class="bd-osc">${macdHtml}</td>
<td class="bd-osc hide-mobile">
  <div style="display:flex;flex-direction:column;align-items:center;gap:2px">
    <span style="font-size:0.7rem;font-weight:600">${_dec(d.atrV)}</span>
    <span style="font-size:0.56rem;color:var(--text3)" title="Stop Loss">SL:${_dec(d.price-(d.atrV||0)*2)}</span>
  </div>
</td>
<td class="bd-osc">
  <div class="adr-wrap">
    <span class="adr-pct" style="color:${adrColor}">${_dec(adrPct,2)}%</span>
    <span class="adr-label">${adrLbl}</span>
  </div>
</td>
</tr>`;
  }).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setDot(s){const d=document.getElementById('sDot');d.className='dot';if(s==='ok')d.classList.add('ok');if(s==='spin')d.classList.add('spin')}
function _ago(ts){const d=Date.now()-ts,h=Math.floor(d/3600000),m=Math.floor((d%3600000)/60000);if(h>=24)return Math.floor(h/24)+'h lalu';if(h>0)return h+'j '+m+'m lalu';return m+'m lalu'}
function toast(m,t='in'){
  const el=document.createElement('div');el.className=`toast ${t}`;el.textContent=m;
  document.getElementById('toasts').appendChild(el);
  requestAnimationFrame(()=>requestAnimationFrame(()=>el.classList.add('show')));
  setTimeout(()=>{el.classList.remove('show');setTimeout(()=>el.remove(),300)},3000);
}
</script>
</body>
</html>
